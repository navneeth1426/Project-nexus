<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus OS | Productivity Suite</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
       :root {
    /* Updated Palette: Deeper colors to allow the "water" effect to pop */
    --bg-dark: #020617;
    --glass: rgba(255, 255, 255, 0.04);
    --glass-border: rgba(255, 255, 255, 0.08);
    --accent: #38bdf8;
    --accent-purple: #8a2be2;
    --accent-glow: 0 0 15px rgba(138, 43, 226, 0.4);
    --text: #f8fafc;
}

body {
    margin: 0;
    padding: 0;
    height: 100vh;
    overflow: hidden;
    background-color: var(--bg-dark);
    /* The "Water" Effect: Multiple layered gradients moving independently */
    background-image: 
        radial-gradient(at 0% 0%, rgba(56, 189, 248, 0.15) 0px, transparent 50%),
        radial-gradient(at 100% 0%, rgba(139, 92, 246, 0.15) 0px, transparent 50%),
        radial-gradient(at 100% 100%, rgba(20, 184, 166, 0.15) 0px, transparent 50%),
        radial-gradient(at 0% 100%, rgba(59, 130, 246, 0.15) 0px, transparent 50%);
    background-size: 200% 200%;
    animation: waterFlow 15s ease infinite;
    color: var(--text);
}

/* Keyframes for the lively background movement */
@keyframes waterFlow {
    0% {
        background-position: 0% 0%;
    }
    25% {
        background-position: 100% 0%;
    }
    50% {
        background-position: 100% 100%;
    }
    75% {
        background-position: 0% 100%;
    }
    100% {
        background-position: 0% 0%;
    }
}

/* Enhancing the Glassmorphism to react to the moving background */
.app-card, .btn-back, .task-controls, .cal-container {
    backdrop-filter: blur(25px) saturate(180%);
    -webkit-backdrop-filter: blur(25px) saturate(180%);
}

        /* --- Splash Screen --- */
        #splash {
            position: fixed;
            inset: 0;
            background: #0f172a;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.8s ease;
        }

        .loader {
            width: 50px;
            height: 50px;
            border: 3px solid var(--glass-border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        /* --- Layout Structures --- */
        .container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 2rem;
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            padding-top: 80px !important;
            box-sizing: border-box;
            overflow-y: auto;
   }

       header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 1.5rem;
    background: rgba(255, 255, 255, 0.03);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid var(--glass-border);
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 100;
}

.logo-section {
    display: flex;
    align-items: center;
    gap: 12px;
}

.logo-icon {
    width: 32px;
    height: 32px;
    background: var(--accent);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #000;
    font-weight: bold;
    box-shadow: 0 0 15px rgba(56, 189, 248, 0.4);
}

.logo-text {
    font-weight: 700;
    letter-spacing: 1px;
    font-size: 1.2rem;
    background: linear-gradient(to right, #fff, var(--accent));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.system-tray {
    display: flex;
    align-items: center;
    gap: 20px;
}

#clock {
    font-family: 'Courier New', monospace;
    font-weight: 600;
    font-size: 1.1rem;
    color: var(--accent);
}

.status-indicator {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.8rem;
    color: #94a3b8;
}

.dot {
    width: 8px;
    height: 8px;
    background: #10b981;
    border-radius: 50%;
    box-shadow: 0 0 8px #10b981;
}

/* Adjust container to give space for fixed header */
.container {
    padding-top: 6rem !important; 
}
        .screen {
            display: none;
            height: calc(100vh - 80px);
            margin-top: 20px;
            animation: fadeIn 0.4s ease-out;
        }

        .screen.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Home Dashboard --- */
        .app-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            max-width: 1000px;
            margin: 0 auto;
        }

        .app-card {
            background: var(--glass);
            backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }

        .app-card:hover {
            transform: translateY(-10px);
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--accent);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .app-card i { font-size: 3rem; color: var(--accent); }

        /* --- Shared App UI --- */
        .app-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .btn-back {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            color: white;
            padding: 0.8rem 1.2rem;
            border-radius: 12px;
            cursor: pointer;
        }

      /* --- Task Flow Integration Styles --- */
        .glass-card { background: var(--glass); backdrop-filter: blur(12px); border: 1px solid var(--glass-border); border-radius: 20px; padding: 20px; margin-bottom: 20px; }
        .progress-bar-bg { height: 8px; background: rgba(255,255,255,0.05); border-radius: 10px; overflow: hidden; margin-top: 10px;}
        #progress-fill { height: 100%; width: 0%; background: linear-gradient(90deg, var(--accent), var(--accent-purple)); transition: width 0.5s ease; }
        
        .timer-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px; }
        .timer-card { text-align: center; background: var(--glass); padding: 10px; border-radius: 12px; border: 1px solid var(--glass-border); }
        .timer-val { display: block; font-size: 1.4rem; font-weight: 700; }
        .timer-label { font-size: 0.6rem; text-transform: uppercase; color: #94a3b8; }

        .task-card {
            display: flex; align-items: center; gap: 15px; padding: 12px;
            background: rgba(255,255,255,0.03); border: 1px solid var(--glass-border);
            border-radius: 15px; margin-bottom: 10px;
        }
        .task-img { width: 45px; height: 45px; border-radius: 8px; object-fit: cover; }
        .task-card.completed { opacity: 0.5; text-decoration: line-through; }
        
        input { background: rgba(0,0,0,0.2); border: 1px solid var(--glass-border); padding: 10px; border-radius: 8px; color: white; }
        .filter-btn { background: transparent; border: none; color: #94a3b8; padding: 5px 12px; cursor: pointer; border-radius: 8px; }
        .filter-btn.active { 
            background: var(--accent-purple) !important;
             color: white;
             box-shadow: 0 0 10px var(--accent-purple);
            }

        /* --- Calculator --- */
 /* --- Optimized Calculator Styles --- */
.calc-body {
    max-width: 340px; /* Slightly wider for better spacing */
    margin: auto;
    background: #0f172a; /* Deeper dark to match Nexus theme */
    padding: 1.5rem;
    border-radius: 24px;
    border: 1px solid var(--glass-border);
    box-shadow: 0 20px 50px rgba(0,0,0,0.5);
}

#calc-display {
    width: 100%;
    height: 70px;
    text-align: right;
    font-size: 2.5rem;
    background: rgba(0, 0, 0, 0.2);
    border: none;
    color: white;
    padding: 0 1rem;
    margin-bottom: 1rem;
    border-radius: 12px;
    font-family: 'monospace';
}

.calc-btns {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
}

.calc-btns button {
    aspect-ratio: 1/1;
    width: 100%; /* Fill the grid column width */
    height: auto; /* Let aspect-ratio handle the height */
    border-radius: 50%; /* Perfect circle */
    border: 1px solid var(--glass-border);
    background: var(--glass);
    color: white;
    font-size: 1.2rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.calc-btns button:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: scale(1.05);
}

.calc-btns .op { 
    background: rgba(245, 158, 11, 0.2); 
    color: #f59e0b;
    border-color: #f59e0b;
}

/* Fix for the special spanning buttons */
.calc-btns button[onclick*="calculate"] {
    grid-row: span 2;
    height: 100%; /* Span buttons need height to fill two rows */
    aspect-ratio: auto; 
    border-radius: 30px; 
}

.calc-btns button[onclick*="'0'"] {
    grid-column: span 2;
    aspect-ratio: auto;
    border-radius: 30px;
}
        /* --- Calendar --- */
        .cal-container {
            background: var(--glass);
            padding: 2rem;
            border-radius: 20px;
            max-width: 500px;
            margin: auto;
        }
        .cal-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            text-align: center;
        }
        .cal-day-name { font-weight: bold; color: var(--accent); }
    
        /* --- User Profile Styling --- */
.user-profile {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 6px 12px;
    border-radius: 12px;
    transition: background 0.3s ease;
    cursor: pointer;
}

.user-profile:hover {
    background: rgba(255, 255, 255, 0.08);
}

.avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: 2px solid var(--accent);
    object-fit: cover;
}

.user-info {
    display: flex;
    flex-direction: column;
    line-height: 1.2;
}

.user-name {
    font-size: 0.9rem;
    font-weight: 600;
    color: white;
}

.user-role {
    font-size: 0.7rem;
    color: var(--accent);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.divider {
    width: 1px;
    height: 24px;
    background: var(--glass-border);
    margin: 0 10px;
}

/* --- Added Animations --- */
.pulse {
    animation: pulse-animation 2s infinite;
}

@keyframes pulse-animation {
    0% { box-shadow: 0 0 0 0px rgba(16, 185, 129, 0.7); }
    100% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
}

/* Ensure Logo Text is still clear */
.logo-text {
    font-size: 1rem;
    font-weight: 800;
    letter-spacing: 2px;
    opacity: 0.8;
}

/* Unique Blob Shape for the Auth Card */
.auth-card {
    background: var(--glass);
    backdrop-filter: blur(25px) saturate(180%);
    -webkit-backdrop-filter: blur(25px) saturate(180%);
    border: 2px solid var(--glass-border);
    padding: 3rem 2.5rem;
    width: 400px;
    /* Organic shape: top-left, top-right, bottom-right, bottom-left / variation */
   border-radius: 65% 35% 51% 49% / 37% 41% 59% 63%;
   overflow: hidden;
   display: flex;
    flex-direction: column;
    align-items: stretch;
}


/* border-radius: 65% 35% 51% 49% / 37% 41% 59% 63%;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4), inset 0 0 20px rgba(255,255,255,0.05);
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;/*





/* Subtle animation to make the shape feel fluid */
@keyframes shapeMorph {
    0% { border-radius: 65% 35% 51% 49% / 37% 41% 59% 63%; }
    50% { border-radius: 50% 50% 33% 67% / 55% 27% 73% 45%; }
    100% { border-radius: 65% 35% 51% 49% / 37% 41% 59% 63%; }
}

.auth-card:hover {
    animation: shapeMorph 8s ease-in-out infinite;
    border-color: var(--accent);
}

/* Premium Rounded Inputs */
.auth-input {
    width: 100%;
    background: rgba(255, 255, 255, 0.05) !important;
    border: 1px solid var(--glass-border) !important;
    border-radius: 30px !important; /* Pill shape like image */
    padding: 12px 20px !important;
    margin-bottom: 15px;
    color: white;
    transition: 0.3s;
}

.auth-input:focus {
    border-color: var(--accent) !important;
    background: rgba(255, 255, 255, 0.1) !important;
    outline: none;
    box-shadow: 0 0 15px rgba(56, 189, 248, 0.2);
}

/* Auth Buttons */
.btn-auth {
    width: 100%;
    padding: 12px;
    border-radius: 30px;
    border: none;
    background: linear-gradient(135deg, var(--accent), var(--accent-purple));
    color: white;
    font-weight: 700;
    cursor: pointer;
    text-transform: uppercase;
    letter-spacing: 1px;
    transition: 0.3s;
}

.btn-auth:hover {
    transform: scale(1.02);
    box-shadow: 0 0 20px rgba(56, 189, 248, 0.4);
}

header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.8rem 2.5rem;
    background: rgba(255, 255, 255, 0.03);
    backdrop-filter: blur(20px) saturate(160%);
    -webkit-backdrop-filter: blur(20px) saturate(160%);
    border-bottom: 1px solid var(--glass-border);
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
    box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
}

.nav-brand {
    display: flex;
    align-items: center;
    gap: 15px;
}

.brand-logo {
    width: 35px;
    height: 35px;
    background: linear-gradient(135deg, var(--accent), var(--accent-purple));
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: var(--accent-glow);
}

.nav-right {
    display: flex;
    align-items: center;
    gap: 25px;
}

/* User Profile Styling in Header */
.user-widget {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 5px 15px;
    background: var(--glass);
    border: 1px solid var(--glass-border);
    border-radius: 50px;
    transition: 0.3s ease;
}

.user-widget:hover {
    background: rgba(255, 255, 255, 0.08);
    border-color: var(--accent);
}

.avatar-sm {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    border: 2px solid var(--accent);
}

/* Weather App Specifics */
.weather-container {
    max-width: 600px;
    margin: 0 auto;
    padding: 20px;
}

.weather-main-card {
    background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
    border-radius: 40px;
    padding: 40px;
    text-align: center;
    position: relative;
    overflow: hidden;
    border: 1px solid var(--glass-border);
}

.weather-icon-lg {
    font-size: 5rem;
    margin: 20px 0;
    filter: drop-shadow(0 0 20px rgba(255,255,255,0.3));
    animation: float 3s ease-in-out infinite;
}

.weather-stats-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
    margin-top: 30px;
}

.stat-item {
    background: var(--glass);
    padding: 15px;
    border-radius: 20px;
    border: 1px solid var(--glass-border);
}

.stat-val { font-weight: 700; display: block; }
.stat-label { font-size: 0.7rem; color: #94a3b8; text-transform: uppercase; }

/* Forecast Strip */
.forecast-strip {
    display: flex;
    gap: 15px;
    overflow-x: auto;
    padding: 20px 0;
    scrollbar-width: none;
}

.forecast-day {
    min-width: 80px;
    background: var(--glass);
    padding: 15px;
    border-radius: 25px;
    text-align: center;
    border: 1px solid var(--glass-border);
}

/* Animations */
@keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

.sun-glow { box-shadow: 0 0 50px rgba(245, 158, 11, 0.3); }
.rain-glow { box-shadow: 0 0 50px rgba(56, 189, 248, 0.3); }


.study-layout {
    display: flex;
    gap: 20px;
    height: calc(100vh - 180px);
}

.study-sidebar {
    width: 200px;
    background: var(--glass);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    padding: 15px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.study-nav-btn {
    background: transparent;
    border: none;
    color: #94a3b8;
    text-align: left;
    padding: 12px 15px;
    border-radius: 12px;
    cursor: pointer;
    transition: 0.3s;
}

.study-nav-btn.active, .study-nav-btn:hover {
    background: rgba(255,255,255,0.05);
    color: var(--accent);
}

.study-content {
    flex: 1;
    overflow-y: auto;
    padding-right: 10px;
}

.study-tab { display: none; animation: fadeIn 0.4s ease; }
.study-tab.active { display: block; }

.quiz-opt {
    background: rgba(255,255,255,0.03);
    border: 1px solid var(--glass-border);
    padding: 12px;
    border-radius: 12px;
    cursor: pointer;
    transition: 0.3s;
}

.quiz-opt:hover { background: rgba(255,255,255,0.08); }
.correct { background: #10b98166 !important; border-color: #10b981 !important; }
.wrong { background: #ef444466 !important; border-color: #ef4444 !important; }


.ox-cell {
    aspect-ratio: 1/1;
    background: var(--glass);
    border: 1px solid var(--glass-border);
    border-radius: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2.5rem;
    font-weight: 800;
    cursor: pointer;
    transition: all 0.3s ease;
    color: white;
}

.ox-cell:hover {
    background: rgba(255, 255, 255, 0.08);
    border-color: var(--accent);
}

.ox-cell.taken {
    cursor: not-allowed;
}

/* Color markers differently */
.ox-cell[data-val="X"] { color: var(--accent); text-shadow: 0 0 10px rgba(56, 189, 248, 0.5); }
.ox-cell[data-val="O"] { color: var(--accent-purple); text-shadow: 0 0 10px rgba(138, 43, 226, 0.5); }

@keyframes popIn {
    0% { transform: scale(0.5); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
}
.mark-anim { a/* Timer Pulsing Animation */
.timer-pulse {
    animation: pulse-glow 2s infinite;
}

@keyframes pulse-glow {
    0% { box-shadow: 0 0 0 0px rgba(56, 189, 248, 0.4); }
    70% { box-shadow: 0 0 0 20px rgba(56, 189, 248, 0); }
    100% { box-shadow: 0 0 0 0px rgba(56, 189, 248, 0); }
}

#focus-timer .glass-card {
    transition: all 0.5s ease;
}

#focus-timer .filter-btn {
    font-size: 0.7rem;
    padding: 5px 12px;
}nimation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }



    </style>
</head>
<body>

    <div id="splash">
        <div class="loader"></div>
        <h2 style="margin-top: 20px; letter-spacing: 4px;">NEXUS OS</h2>
    </div>

    <div class="container">
 
<header>
    <div class="nav-brand">
        <div class="brand-logo">
            <i class="fas fa-nexus-ui" style="color: white; font-size: 1.2rem;"></i>
        </div>
        <div class="logo-text" style="font-size: 1.4rem;">NEXUS OS</div>
    </div>

    <div class="nav-right">
        <div class="system-tray">
            <h1 id="clock" style="margin: 0; font-size: 1rem; color: #94a3b8;">00:00:00</h1>
        </div>

        <div class="divider"></div>

        <div id="auth-controls">
            <button id="login-trigger-btn" onclick="showLoginModal()" class="btn-auth" style="padding: 8px 20px; font-size: 0.8rem;">
                <i class="fas fa-sign-in-alt"></i> Sign In
            </button>

            <div id="user-profile-widget" class="user-widget" style="display: none;">
                <div class="user-info" style="text-align: right;">
                    <span id="display-name" class="user-name" style="display: block; font-size: 0.85rem;">Guest</span>
                    <span class="user-role" style="font-size: 0.6rem; color: var(--accent);">PREMIUM</span>
                </div>
                <img src="" id="user-avatar" alt="User" class="avatar-sm">
                <i class="fas fa-power-off" onclick="handleLogout()" style="margin-left: 10px; cursor: pointer; color: #ef4444; font-size: 0.8rem;"></i>
            </div>
        </div>
    </div>
</header>

<div id="auth-overlay" style="display:none; position:fixed; inset:0; background:rgba(2, 6, 23, 0.7); z-index:2000; align-items:center; justify-content:center; backdrop-filter:blur(15px);">
    
    <div id="signin-container" class="auth-card">
        <div style="text-align: center; margin-bottom: 20px;">
             <div style="width: 50px; height: 50px; background: rgba(255,255,255,0.1); border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; margin-bottom: 10px;">
                <i class="fas fa-fingerprint" style="font-size: 1.5rem; color: var(--accent);"></i>
             </div>
             <h2 style="margin: 0; font-weight: 300; letter-spacing: 2px;">Sign In</h2>
        </div>
        
        <input type="text" id="signin-user" class="auth-input" placeholder="Username">
        <input type="password" class="auth-input" placeholder="Password"> <div style="display: flex; justify-content: space-between; font-size: 0.75rem; margin-bottom: 20px; color: #94a3b8; padding: 0 10px;">
            <label><input type="checkbox"> Remember me</label>
            <a href="#" style="color: var(--accent); text-decoration: none;">Forgot password?</a>
        </div>

        <button onclick="handleSignIn()" class="btn-auth">Login</button>

        <p style="text-align: center; font-size: 0.8rem; margin-top: 25px; color: #94a3b8;">
            Don't have an account? 
            <span onclick="toggleAuthMode('signup')" style="color: var(--accent); cursor: pointer; font-weight: bold;">Sign Up</span>
        </p>
    </div>

    <div id="signup-container" class="auth-card" style="display:none;">
        <h2 style="text-align: center; margin-bottom: 25px; font-weight: 300; letter-spacing: 2px;">Create Account</h2>
        
        <input type="text" id="reg-user" class="auth-input" placeholder="Full Name">
        <input type="email" id="reg-email" class="auth-input" placeholder="Email Address">
        <input type="password" id="reg-pass" class="auth-input" placeholder="Password">
        
        <button onclick="handleSignUp()" class="btn-auth" style="background: var(--accent-purple);">Sign Up</button>

        <button onclick="toggleAuthMode('signin')" style="width: 100%; background: none; border: none; color: #94a3b8; margin-top: 15px; cursor: pointer;">
            <i class="fas fa-arrow-left"></i> Back to Login
        </button>
    </div>
</div>
        <div id="home" class="screen active">
            <div class="app-grid">
                <div class="app-card" onclick="openApp('tasks')">
                    <i class="fas fa-tasks"></i>
                    <h3>Task Scheduler</h3>
                    <p>Manage your deadlines</p>
                </div>
                <div class="app-card" onclick="openApp('calc')">
                    <i class="fas fa-calculator"></i>
                    <h3>Calculator</h3>
                    <p>Quick computations</p>
                </div>
                <div class="app-card" onclick="openApp('calendar')">
                    <i class="fas fa-calendar-alt"></i>
                    <h3>Calendar</h3>
                    <p>View schedule</p>
                </div>
                <div class="app-card" onclick="alert('Notes app coming soon!')">
                    <i class="fas fa-sticky-note"></i>
                    <h3>Notes</h3>
                    <p>Save your thoughts</p>
                </div>
               <div class="app-card" onclick="openApp('weather')">
    <i class="fas fa-cloud-sun"></i>
    <h3>Weather</h3>
    <p>Local Forecast</p>
</div>

<div class="app-card" onclick="openApp('study-corner')">
    <i class="fas fa-graduation-cap"></i>
    <h3>Study Corner</h3>
    <p>Coding Revision Hub</p>
</div>

<div class="app-card" onclick="openApp('ox-game')">
    <i class="fas fa-times-circle"></i>
    <h3>OX Game</h3>
    <p>Boredom Buster</p>
</div>

<div class="app-card" onclick="openApp('focus-timer')">
    <i class="fas fa-stopwatch"></i>
    <h3>Focus Timer</h3>
    <p>Boost Productivity</p>
</div>
            </div>
        </div>

         <div id="tasks" class="screen">
            <div style="display:flex; align-items:center; gap:15px; margin-bottom:20px;">
                <button onclick="goHome()" class="filter-btn active"><i class="fas fa-arrow-left"></i></button>
                <h2>Task Flow </h2>
            </div>

            <div class="glass-card">
                <div style="display:flex; justify-content:space-between; font-size:0.8rem;">
                    <span>Completion Progress</span>
                    <span id="progress-percent">0%</span>
                </div>
                <div class="progress-bar-bg"><div id="progress-fill"></div></div>
            </div>

            <div class="timer-grid">
                <div class="timer-card"><span class="timer-val" id="days">00</span><span class="timer-label">Days</span></div>
                <div class="timer-card"><span class="timer-val" id="hours">00</span><span class="timer-label">Hrs</span></div>
                <div class="timer-card"><span class="timer-val" id="minutes">00</span><span class="timer-label">Min</span></div>
                <div class="timer-card"><span class="timer-val" id="seconds">00</span><span class="timer-label">Sec</span></div>
            </div>

            <div class="glass-card">
                <div style="display:grid; gap:10px;">
                    <input type="text" id="task-input" placeholder="New Objective...">
                    <div style="display:flex; gap:10px;">
                        <input type="datetime-local" id="deadline-input" style="flex:1">
                        <button onclick="document.getElementById('image-input').click()" class="filter-btn" style="background:var(--glass)"><i class="fas fa-image"></i></button>
                        <input type="file" id="image-input" hidden accept="image/*">
                        <button onclick="addTask()" class="filter-btn active" style="width:50px">+</button>
                    </div>
                </div>
            </div>

            <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                <div class="filter-pills" style="background:var(--glass); border-radius:10px; padding:4px;">
                    <button class="filter-btn active" onclick="setFilter('all')">All</button>
                    <button class="filter-btn" onclick="setFilter('active')">Active</button>
                    <button class="filter-btn" onclick="setFilter('completed')">Done</button>
                </div>
                <span id="task-count" style="font-size:0.8rem; color:#94a3b8">0 Tasks</span>
            </div>

            <div id="task-list"></div>
        </div>

        <div id="calc" class="screen">
            <div class="app-header">
                <button class="btn-back" onclick="goHome()"><i class="fas fa-arrow-left"></i></button>
                <h2>Calculator</h2>
            </div>
            <div class="calc-body">
                <input type="text" id="calc-display" disabled value="0">
                <div class="calc-btns">
                    <button onclick="clearCalc()">C</button>
                    <button onclick="calcInput('/')" class="op">/</button>
                    <button onclick="calcInput('*')" class="op">×</button>
                    <button onclick="deleteCalc()">DEL</button>
                    <button onclick="calcInput('7')">7</button>
                    <button onclick="calcInput('8')">8</button>
                    <button onclick="calcInput('9')">9</button>
                    <button onclick="calcInput('-')" class="op">-</button>
                    <button onclick="calcInput('4')">4</button>
                    <button onclick="calcInput('5')">5</button>
                    <button onclick="calcInput('6')">6</button>
                    <button onclick="calcInput('+')" class="op">+</button>
                    <button onclick="calcInput('1')">1</button>
                    <button onclick="calcInput('2')">2</button>
                    <button onclick="calcInput('3')">3</button>
                    <button onclick="calculate()" style="grid-row: span 2; height: auto; background: var(--accent); color: black;">=</button>
                    <button onclick="calcInput('0')" style="grid-column: span 2; border-radius: 30px;">0</button>
                    <button onclick="calcInput('.')">.</button>
                </div>
            </div>
        </div>

        <div id="calendar" class="screen">
            <div class="app-header">
                <button class="btn-back" onclick="goHome()"><i class="fas fa-arrow-left"></i></button>
                <h2 id="current-month-year">Calendar</h2>
            </div>
            <div class="cal-container">
                <div class="cal-grid" id="cal-grid">
                    </div>
            </div>
        </div>
        <div id="weather" class="screen">
    <div class="app-header">
        <button class="btn-back" onclick="goHome()"><i class="fas fa-arrow-left"></i></button>
        <h2>Weather Station</h2>
    </div>

    <div class="weather-container">
        <div id="weather-card" class="weather-main-card">
            <h2 id="w-city" style="margin-bottom: 5px;">Detecting Location...</h2>
            <span id="w-date" style="color: #94a3b8; font-size: 0.9rem;">Thursday, 19 Feb</span>
            
            <div id="w-icon-container">
                <i id="w-icon" class="fas fa-sun weather-icon-lg"></i>
            </div>
            
            <h1 id="w-temp" style="font-size: 4rem; margin: 0;">--°C</h1>
            <p id="w-desc" style="text-transform: capitalize; letter-spacing: 1px;">Clear Sky</p>
            
            <div class="weather-stats-grid">
                <div class="stat-item"><span class="stat-label">Feels Like</span><span class="stat-val" id="w-feels">--°</span></div>
                <div class="stat-item"><span class="stat-label">Humidity</span><span class="stat-val" id="w-humidity">--%</span></div>
                <div class="stat-item"><span class="stat-label">Wind</span><span class="stat-val" id="w-wind">-- km/h</span></div>
            </div>

            <div class="weather-stats-grid" style="margin-top: 15px;">
                <div class="stat-item"><span class="stat-label">Pressure</span><span class="stat-val" id="w-pressure">-- hPa</span></div>
                <div class="stat-item"><span class="stat-label">Sunrise</span><span class="stat-val" id="w-sunrise">--:--</span></div>
                <div class="stat-item"><span class="stat-label">Sunset</span><span class="stat-val" id="w-sunset">--:--</span></div>
            </div>
        </div>

        <h3 style="margin-top: 30px; font-weight: 300;">7-Day Forecast</h3>
        <div class="forecast-strip" id="forecast-container">
            </div>
    </div>
</div>

<div id="study-corner" class="screen">
    <div class="app-header">
        <button class="btn-back" onclick="goHome()"><i class="fas fa-arrow-left"></i></button>
        <h2>Study Corner</h2>
    </div>

    <div class="study-layout">
        <div class="study-sidebar">
            <button class="study-nav-btn active" onclick="switchStudyTab('study-dash')"><i class="fas fa-th-large"></i> Dashboard</button>
            <button class="study-nav-btn" onclick="switchStudyTab('study-topics')"><i class="fas fa-book"></i> Topics</button>
            <button class="study-nav-btn" onclick="switchStudyTab('study-quiz')"><i class="fas fa-gamepad"></i> Quiz Game</button>
            <button class="study-nav-btn" onclick="switchStudyTab('study-links')"><i class="fas fa-external-link-alt"></i> Resources</button>
            
        </div>

        <div class="study-content">
            <div id="study-dash" class="study-tab active">
                <div class="glass-card">
                    <h2>Welcome to Revision Hub</h2>
                    <p>Select a section from the sidebar to start your coding prep.</p>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin-top:20px;">
                        <div class="stat-item"><span class="stat-label">Daily Goal</span><span class="stat-val">2 Topics</span></div>
                        <div class="stat-item"><span class="stat-label">Last Quiz Score</span><span class="stat-val" id="last-score">0%</span></div>
                    </div>
                </div>
            </div>

            <div id="study-topics" class="study-tab">
                <h3>Select Subject</h3>
                <div class="filter-pills" style="margin-bottom:20px;">
                    <button class="filter-btn active" onclick="loadTopics('c')">C</button>
                    <button class="filter-btn" onclick="loadTopics('py')">Python</button>
                    <button class="filter-btn" onclick="loadTopics('java')">Java</button>
                    <button class="filter-btn" onclick="loadTopics('ds')">DSA</button>
                </div>
                <div id="topic-display" class="glass-card">
                    </div>
            </div>

            <div id="study-quiz" class="study-tab">
                <div id="quiz-init">
                    <h3>Ready for a Challenge?</h3>
                    <select id="quiz-subject" class="auth-input">
                        <option value="c">C Programming</option>
                        <option value="java">Java</option>
                        <option value="sql">SQL / DBMS</option>
                    </select>
                    <button onclick="startQuiz()" class="btn-auth">Start Quiz</button>
                </div>
                <div id="quiz-play" style="display:none;">
                    <h4 id="quiz-q">Question text?</h4>
                    <div id="quiz-options" style="display:grid; gap:10px; margin:20px 0;"></div>
                    <div id="quiz-feedback" style="margin-bottom:15px; font-weight:bold;"></div>
                    <button id="next-q-btn" onclick="nextQuestion()" class="filter-btn active" style="display:none;">Next Question</button>
                </div>
            </div>

            <div id="study-links" class="study-tab">
                <div class="app-grid" style="grid-template-columns: 1fr 1fr; gap:10px;">
                    <a href="https://www.geeksforgeeks.org" target="_blank" class="app-card" style="padding:15px;"><h4>GeeksforGeeks</h4></a>
                    <a href="https://www.w3schools.com" target="_blank" class="app-card" style="padding:15px;"><h4>W3Schools</h4></a>
                    <a href="https://leetcode.com" target="_blank" class="app-card" style="padding:15px;"><h4>LeetCode</h4></a>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="ox-game" class="screen">
    <div class="app-header">
        <button class="btn-back" onclick="goHome()"><i class="fas fa-arrow-left"></i></button>
        <h2>OX Game – Tic-Tac-Toe</h2>
    </div>

    <div class="game-container" style="max-width: 400px; margin: 0 auto; text-align: center;">
        <div class="glass-card" style="margin-bottom: 20px; padding: 15px;">
            <h3 id="game-status" style="color: var(--accent); margin: 0;">Player X's Turn</h3>
        </div>

        <div id="ox-grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 25px;">
            <div class="ox-cell" onclick="makeMove(0)"></div>
            <div class="ox-cell" onclick="makeMove(1)"></div>
            <div class="ox-cell" onclick="makeMove(2)"></div>
            <div class="ox-cell" onclick="makeMove(3)"></div>
            <div class="ox-cell" onclick="makeMove(4)"></div>
            <div class="ox-cell" onclick="makeMove(5)"></div>
            <div class="ox-cell" onclick="makeMove(6)"></div>
            <div class="ox-cell" onclick="makeMove(7)"></div>
            <div class="ox-cell" onclick="makeMove(8)"></div>
        </div>

        <button onclick="resetOX()" class="btn-auth" style="width: 100%; max-width: 200px;">
            <i class="fas fa-redo"></i> Restart Game
        </button>
    </div>
</div>

<div id="focus-timer" class="screen">
    <div class="app-header">
        <button class="btn-back" onclick="goHome()"><i class="fas fa-arrow-left"></i></button>
        <h2>Focus Timer</h2>
    </div>

    <div class="timer-container" style="max-width: 500px; margin: 0 auto; text-align: center;">
        <div class="glass-card" style="margin-bottom: 20px; padding: 15px;">
            <h3 id="timer-status" style="color: var(--accent); margin: 0;">Time to Focus!</h3>
            <span id="session-count" style="font-size: 0.8rem; color: #94a3b8;">Completed Sessions: 0</span>
        </div>

        <div class="glass-card" style="padding: 40px; border-radius: 50%; width: 300px; height: 300px; margin: 0 auto; display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative; border: 2px solid var(--glass-border);">
            <div id="timer-display" style="font-size: 4rem; font-weight: 800; font-family: 'Courier New', monospace; color: white;">25:00</div>
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button onclick="setTimerMode('focus')" class="filter-btn active" id="mode-focus">Focus</button>
                <button onclick="setTimerMode('short')" class="filter-btn" id="mode-short">Short</button>
                <button onclick="setTimerMode('long')" class="filter-btn" id="mode-long">Long</button>
            </div>
        </div>

        <div style="margin-top: 30px; display: flex; justify-content: center; gap: 15px;">
            <button onclick="toggleTimer()" id="timer-start-btn" class="btn-auth" style="width: 120px;">
                <i class="fas fa-play"></i> Start
            </button>
            <button onclick="resetTimer()" class="filter-btn" style="padding: 12px 25px; background: rgba(255,255,255,0.05);">
                <i class="fas fa-redo"></i> Reset
            </button>
        </div>
    </div>
</div>

    </div>

    <script>
        // Splash Screen Logic
        window.addEventListener('load', () => {
            setTimeout(() => {
                document.getElementById('splash').style.opacity = '0';
                setTimeout(() => document.getElementById('splash').style.display = 'none', 800);
            }, 1500);
            updateClock();
            setInterval(updateClock, 1000);
            renderCalendar();
        });

        // Navigation
        function openApp(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function goHome() {
            openApp('home');
        }

        function updateClock() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', second:'2-digit'});
        }

         let tasks = JSON.parse(localStorage.getItem('nexus_tasks')) || [];
        let deadline = localStorage.getItem('nexus_deadline') || "";
        let currentFilter = 'all';

        function openApp(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(id === 'tasks') renderTasks();
        }
        function goHome() { openApp('home'); }

      function addTask() {
            const text = document.getElementById('task-input').value;
            const dl = document.getElementById('deadline-input').value;
            const imgFile = document.getElementById('image-input').files[0];

            if(!text) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                tasks.push({ id: Date.now(), text, completed: false, image: e.target.result || null });
                if(dl) { deadline = dl; localStorage.setItem('nexus_deadline', dl); }
                saveAndRender();
                document.getElementById('task-input').value = "";
            };
            if(imgFile) reader.readAsDataURL(imgFile);
            else reader.onload({target: {result: null}});
        }

        function toggleTask(id) {
            tasks = tasks.map(t => t.id === id ? {...t, completed: !t.completed} : t);
            saveAndRender();
        }

        function deleteTask(id) {
            tasks = tasks.filter(t => t.id !== id);
            saveAndRender();
        }

        function setFilter(f) {
            currentFilter = f;
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.toggle('active', b.innerText.toLowerCase().includes(f)));
            renderTasks();
        }

        function saveAndRender() {
            localStorage.setItem('nexus_tasks', JSON.stringify(tasks));
            renderTasks();
        }

        function renderTasks() {
            const list = document.getElementById('task-list');
            list.innerHTML = "";
            const filtered = tasks.filter(t => currentFilter === 'all' ? true : (currentFilter === 'completed' ? t.completed : !t.completed));
            
            filtered.forEach(t => {
                const div = document.createElement('div');
                div.className = `task-card ${t.completed ? 'completed' : ''}`;
                div.innerHTML = `
                    ${t.image ? `<img src="${t.image}" class="task-img">` : '<div style="width:45px; height:45px; background:var(--glass); border-radius:8px"></div>'}
                    <div style="flex:1"><strong>${t.text}</strong></div>
                    <button onclick="toggleTask(${t.id})" class="filter-btn" style="color:var(--accent)">✓</button>
                    <button onclick="deleteTask(${t.id})" class="filter-btn" style="color:#ef4444">✕</button>
                `;
                list.appendChild(div);
            });

            // Progress Update
            const completed = tasks.filter(t => t.completed).length;
            const percent = tasks.length ? Math.round((completed / tasks.length) * 100) : 0;
            document.getElementById('progress-fill').style.width = percent + "%";
            document.getElementById('progress-percent').innerText = percent + "%";
            document.getElementById('task-count').innerText = `${tasks.length} Tasks`;
        }

        // --- System Utilities ---
        setInterval(() => {
            document.getElementById('clock').innerText = new Date().toLocaleTimeString();
            if(deadline) {
                const diff = new Date(deadline) - new Date();
                if(diff > 0) {
                    document.getElementById('days').innerText = Math.floor(diff/(1000*60*60*24)).toString().padStart(2,'0');
                    document.getElementById('hours').innerText = Math.floor((diff/(1000*60*60))%24).toString().padStart(2,'0');
                    document.getElementById('minutes').innerText = Math.floor((diff/(1000*60))%60).toString().padStart(2,'0');
                    document.getElementById('seconds').innerText = Math.floor((diff/1000)%60).toString().padStart(2,'0');
                }
            }
        }, 1000);

        // Calculator Logic
        let calcVal = "0";
        function calcInput(v) {
            if(calcVal === "0") calcVal = v;
            else calcVal += v;
            document.getElementById('calc-display').value = calcVal;
        }
        function clearCalc() { calcVal = "0"; document.getElementById('calc-display').value = calcVal; }
        function calculate() {
            try { calcVal = eval(calcVal).toString(); } 
            catch { calcVal = "Error"; }
            document.getElementById('calc-display').value = calcVal;
        }

        // Calendar Logic
        function renderCalendar() {
            const grid = document.getElementById('cal-grid');
            const now = new Date();
            const month = now.toLocaleString('default', { month: 'long' });
            document.getElementById('current-month-year').innerText = `${month} ${now.getFullYear()}`;
            
            const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            dayNames.forEach(d => grid.innerHTML += `<div class="cal-day-name">${d}</div>`);
            
            const firstDay = new Date(now.getFullYear(), now.getMonth(), 1).getDay();
            const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();

            for(let i=0; i<firstDay; i++) grid.innerHTML += `<div></div>`;
            for(let i=1; i<=daysInMonth; i++) {
                const isToday = i === now.getDate() ? 'style="background:var(--accent); color:black; border-radius:50%"' : '';
                grid.innerHTML += `<div ${isToday}>${i}</div>`;
            }
        }
   
  // --- Updated Login & Security Logic ---

// Run this on page load
window.addEventListener('DOMContentLoaded', () => {
    const savedUser = localStorage.getItem('nexus_user');
    if (savedUser) {
        applyLoginState(savedUser);
    } else {
        // Ensure guest state if no one is logged in
        document.getElementById('display-name').innerText = "Guest User";
        document.getElementById('user-status').innerText = "Locked";
    }
});

function showLoginModal() {
    document.getElementById('login-modal').style.display = 'flex';
}

function closeLoginModal() {
    document.getElementById('login-modal').style.display = 'none';
}

function performLogin() {
    const name = document.getElementById('username-input').value;
    if (name.trim() === "") {
        alert("Please enter a name to initialize.");
        return;
    }

    localStorage.setItem('nexus_user', name);
    applyLoginState(name);
    closeLoginModal();
    alert(`Welcome back, ${name}. System unlocked.`);
}

function applyLoginState(name) {
    document.getElementById('display-name').innerText = name;
    document.getElementById('user-status').innerText = "Premium Account";
    document.getElementById('user-avatar').src = `https://ui-avatars.com/api/?name=${name}&background=38bdf8&color=fff`;
    
    // Hide the Login button from the header once logged in
    document.getElementById('login-trigger-btn').style.display = 'none';
}

// Security Gatekeeper
function openApp(id) {
    const isLoggedIn = localStorage.getItem('nexus_user');
    
    if (!isLoggedIn) {
        // ONLY show the alert. DO NOT call showLoginModal() here.
        alert("⚠️ LOGIN REQUIRED: Please use the login button in the header to access this feature.");
        return; 
    }

    // Normal navigation if logged in
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    if(id === 'tasks') renderTasks();
}

// --- Auth State Management ---

function toggleAuthMode(mode) {
    const signin = document.getElementById('signin-container');
    const signup = document.getElementById('signup-container');
    
    if (mode === 'signup') {
        signin.style.display = 'none';
        signup.style.display = 'block';
    } else {
        signup.style.display = 'none';
        signin.style.display = 'block';
    }
}

function handleSignUp() {
    const user = document.getElementById('reg-user').value.trim();
    const email = document.getElementById('reg-email').value.trim();
    const pass = document.getElementById('reg-pass').value.trim();

    if (!user || !email || !pass) {
        alert("Please fill all fields to register.");
        return;
    }

    // Retrieve existing users or start fresh
    let users = JSON.parse(localStorage.getItem('nexus_registered_users')) || [];
    
    // Check if username exists
    if (users.find(u => u.username.toLowerCase() === user.toLowerCase())) {
        alert("This username is already taken!");
        return;
    }

    // Save New User
    users.push({ username: user, email: email, password: pass });
    localStorage.setItem('nexus_registered_users', JSON.stringify(users));
    
    alert("Registration Successful! Please Sign In.");
    toggleAuthMode('signin');
}

function handleSignIn() {
    const inputUser = document.getElementById('signin-user').value.trim();
    const registeredUsers = JSON.parse(localStorage.getItem('nexus_registered_users')) || [];

    // Find the user in our "Database"
    const validUser = registeredUsers.find(u => u.username.toLowerCase() === inputUser.toLowerCase());

    if (validUser) {
        // Log them in
        localStorage.setItem('nexus_active_session', validUser.username);
        applyLoginState(validUser.username);
        document.getElementById('auth-overlay').style.display = 'none';
        alert(`Access Granted. Welcome, ${validUser.username}.`);
    } else {
        alert("User not found. Please check your username or Sign Up.");
    }
}

function applyLoginState(name) {
    // 1. Update Profile Info
    document.getElementById('display-name').innerText = name;
    document.getElementById('user-avatar').src = `https://ui-avatars.com/api/?name=${name}&background=38bdf8&color=fff`;
    
    // 2. Toggle Header Elements
    document.getElementById('login-trigger-btn').style.display = 'none';
    document.getElementById('user-profile-widget').style.display = 'flex';
}

function handleLogout() {
    if(confirm("Are you sure you want to log out of Nexus OS?")) {
        localStorage.removeItem('nexus_active_session');
        window.location.reload(); // Quickest way to reset state to locked
    }
}

// Modify your handleSignIn success block to ensure it calls the new applyLoginState
function handleSignIn() {
    const inputUser = document.getElementById('signin-user').value.trim();
    const registeredUsers = JSON.parse(localStorage.getItem('nexus_registered_users')) || [];
    const validUser = registeredUsers.find(u => u.username.toLowerCase() === inputUser.toLowerCase());

    if (validUser) {
        localStorage.setItem('nexus_active_session', validUser.username);
        applyLoginState(validUser.username); // Triggers the header change
        document.getElementById('auth-overlay').style.display = 'none';
    } else {
        alert("User not found.");
    }
}

// Modify the check on Page Load
window.addEventListener('DOMContentLoaded', () => {
    const activeSession = localStorage.getItem('nexus_active_session');
    if (activeSession) {
        applyLoginState(activeSession);
    }
});

// Security Gatekeeper for Apps
function openApp(id) {
    if (!localStorage.getItem('nexus_active_session')) {
        alert("⚠️ SECURITY ALERT: Unauthorized Access. Please Sign In.");
        document.getElementById('auth-overlay').style.display = 'flex';
        return;
    }
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    if(id === 'tasks') renderTasks();
}

// Function specifically for the header button
function showLoginModal() {
    document.getElementById('auth-overlay').style.display = 'flex';
    toggleAuthMode('signin');
}

function deleteCalc() {
    if (calcVal.length > 1) {
        calcVal = calcVal.slice(0, -1);
    } else {
        calcVal = "0";
    }
    document.getElementById('calc-display').value = calcVal;
}

const WEATHER_API_KEY = 'YOUR_API_KEY'; // Get yours for free at openweathermap.org

function openApp(id) {
    if (!localStorage.getItem('nexus_active_session')) {
        alert("⚠️ SECURITY ALERT: Unauthorized Access. Please Sign In.");
        document.getElementById('auth-overlay').style.display = 'flex';
        return;
    }
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    
    if(id === 'weather') initWeather();
    if(id === 'tasks') renderTasks();
}

function initWeather() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(position => {
            getWeatherData(position.coords.latitude, position.coords.longitude);
        }, () => {
            alert("Unable to retrieve location. Defaulting to London.");
            getWeatherData(51.5074, -0.1278);
        });
    }
}

async function getWeatherData(lat, lon) {
    try {
        const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=${WEATHER_API_KEY}`);
        const data = await response.json();
        updateWeatherUI(data);
    } catch (error) {
        console.error("Weather Error:", error);
    }
}

function updateWeatherUI(data) {
    document.getElementById('w-city').innerText = data.name;
    document.getElementById('w-temp').innerText = `${Math.round(data.main.temp)}°C`;
    document.getElementById('w-desc').innerText = data.weather[0].description;
    document.getElementById('w-humidity').innerText = `${data.main.humidity}%`;
    document.getElementById('w-wind').innerText = `${data.wind.speed} km/h`;
    document.getElementById('w-feels').innerText = `${Math.round(data.main.feels_like)}°`;
    document.getElementById('w-pressure').innerText = data.main.pressure;
    
    // Convert Sunrise/Sunset
    const formatTime = (unix) => new Date(unix * 1000).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    document.getElementById('w-sunrise').innerText = formatTime(data.sys.sunrise);
    document.getElementById('w-sunset').innerText = formatTime(data.sys.sunset);

    // Dynamic Icons & Card Glow
    const iconMapping = {
        'Clear': 'fa-sun',
        'Clouds': 'fa-cloud',
        'Rain': 'fa-cloud-showers-heavy',
        'Snow': 'fa-snowflake',
        'Thunderstorm': 'fa-bolt'
    };
    const mainWeather = data.weather[0].main;
    const iconClass = iconMapping[mainWeather] || 'fa-cloud';
    
    const iconEl = document.getElementById('w-icon');
    iconEl.className = `fas ${iconClass} weather-icon-lg`;
    
    const card = document.getElementById('weather-card');
    card.className = 'weather-main-card ' + (mainWeather === 'Clear' ? 'sun-glow' : 'rain-glow');
}

const studyData = {
    topics: {
        c: "<h4>Pointers</h4><p>Variables that store memory addresses. Essential for dynamic memory and arrays.</p><h4>Structures</h4><p>User-defined data types that group different variables.</p>",
        java: "<h4>JVM</h4><p>Java Virtual Machine allows Java to run on any device. Bytecode is the key.</p><h4>Inheritance</h4><p>Mechanism where one class acquires properties of another.</p>"
    },
    quizzes: {
        c: [
            { q: "What is a pointer?", a: ["Memory Address", "Value", "Variable Name"], c: 0 },
            { q: "Keyword for integer?", a: ["int", "float", "char"], c: 0 }
        ]
    }
};

let currentQuiz = [];
let qIdx = 0;
let score = 0;

function switchStudyTab(tabId) {
    document.querySelectorAll('.study-tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.study-nav-btn').forEach(b => b.classList.remove('active'));
    document.getElementById(tabId).classList.add('active');
    event.currentTarget.classList.add('active');
}

function loadTopics(sub) {
    document.getElementById('topic-display').innerHTML = studyData.topics[sub] || "Content coming soon!";
}

function startQuiz() {
    const sub = document.getElementById('quiz-subject').value;
    currentQuiz = studyData.quizzes[sub] || [];
    qIdx = 0; score = 0;
    document.getElementById('quiz-init').style.display = 'none';
    document.getElementById('quiz-play').style.display = 'block';
    showQuestion();
}

function showQuestion() {
    const q = currentQuiz[qIdx];
    document.getElementById('quiz-q').innerText = q.q;
    const opts = document.getElementById('quiz-options');
    opts.innerHTML = "";
    q.a.forEach((opt, i) => {
        const btn = document.createElement('div');
        btn.className = 'quiz-opt';
        btn.innerText = opt;
        btn.onclick = () => checkAnswer(i, btn);
        opts.appendChild(btn);
    });
    document.getElementById('next-q-btn').style.display = 'none';
    document.getElementById('quiz-feedback').innerText = "";
}

function checkAnswer(i, btn) {
    const correct = currentQuiz[qIdx].c;
    if (i === correct) {
        btn.classList.add('correct');
        score++;
        document.getElementById('quiz-feedback').innerText = "Correct! ✅";
    } else {
        btn.classList.add('wrong');
        document.getElementById('quiz-feedback').innerText = "Wrong! ❌";
    }
    document.getElementById('next-q-btn').style.display = 'block';
}

function nextQuestion() {
    qIdx++;
    if (qIdx < currentQuiz.length) {
        showQuestion();
    } else {
        alert(`Quiz Over! Score: ${score}/${currentQuiz.length}`);
        document.getElementById('quiz-init').style.display = 'block';
        document.getElementById('quiz-play').style.display = 'none';
    }
}


let oxBoard = ["", "", "", "", "", "", "", "", ""];
let currentPlayer = "X";
let oxActive = true;

const winPatterns = [
    [0, 1, 2], [3, 4, 5], [6, 7, 8], // Rows
    [0, 3, 6], [1, 4, 7], [2, 5, 8], // Cols
    [0, 4, 8], [2, 4, 6]             // Diagonals
];

function makeMove(index) {
    if (!oxActive || oxBoard[index] !== "") return;

    oxBoard[index] = currentPlayer;
    const cell = document.querySelectorAll('.ox-cell')[index];
    cell.innerHTML = `<span class="mark-anim">${currentPlayer}</span>`;
    cell.setAttribute('data-val', currentPlayer);
    cell.classList.add('taken');

    checkOXResult();
}

function checkOXResult() {
    let won = false;
    for (let pattern of winPatterns) {
        const [a, b, c] = pattern;
        if (oxBoard[a] && oxBoard[a] === oxBoard[b] && oxBoard[a] === oxBoard[c]) {
            won = true;
            break;
        }
    }

    if (won) {
        document.getElementById('game-status').innerText = `Player ${currentPlayer} Wins! 🎉`;
        oxActive = false;
        return;
    }

    if (!oxBoard.includes("")) {
        document.getElementById('game-status').innerText = "It's a Draw! 🤝";
        oxActive = false;
        return;
    }

    currentPlayer = currentPlayer === "X" ? "O" : "X";
    document.getElementById('game-status').innerText = `Player ${currentPlayer}'s Turn`;
}

function resetOX() {
    oxBoard = ["", "", "", "", "", "", "", "", ""];
    currentPlayer = "X";
    oxActive = true;
    document.getElementById('game-status').innerText = "Player X's Turn";
    document.querySelectorAll('.ox-cell').forEach(cell => {
        cell.innerHTML = "";
        cell.classList.remove('taken');
        cell.removeAttribute('data-val');
    });
}

let timerInterval;
let timeLeft = 1500; // 25 minutes in seconds
let isTimerRunning = false;
let completedSessions = 0;
let currentMode = 'focus';

function setTimerMode(mode) {
    currentMode = mode;
    clearInterval(timerInterval);
    isTimerRunning = false;
    document.getElementById('timer-start-btn').innerHTML = '<i class="fas fa-play"></i> Start';
    
    // UI Update
    document.querySelectorAll('#focus-timer .filter-btn').forEach(btn => btn.classList.remove('active'));
    document.getElementById(`mode-${mode}`).classList.add('active');

    if (mode === 'focus') {
        timeLeft = 1500;
        document.getElementById('timer-status').innerText = "Time to Focus!";
    } else if (mode === 'short') {
        timeLeft = 300;
        document.getElementById('timer-status').innerText = "Short Break!";
    } else {
        timeLeft = 900;
        document.getElementById('timer-status').innerText = "Long Break!";
    }
    updateTimerDisplay();
}

function updateTimerDisplay() {
    const mins = Math.floor(timeLeft / 60);
    const secs = timeLeft % 60;
    document.getElementById('timer-display').innerText = 
        `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
}

function toggleTimer() {
    const btn = document.getElementById('timer-start-btn');
    const timerCard = document.querySelector('#focus-timer .glass-card[style*="border-radius: 50%"]');

    if (isTimerRunning) {
        clearInterval(timerInterval);
        btn.innerHTML = '<i class="fas fa-play"></i> Start';
        timerCard.classList.remove('timer-pulse');
    } else {
        timerInterval = setInterval(() => {
            if (timeLeft > 0) {
                timeLeft--;
                updateTimerDisplay();
            } else {
                handleTimerEnd();
            }
        }, 1000);
        btn.innerHTML = '<i class="fas fa-pause"></i> Pause';
        timerCard.classList.add('timer-pulse');
    }
    isTimerRunning = !isTimerRunning;
}

function handleTimerEnd() {
    clearInterval(timerInterval);
    isTimerRunning = false;
    document.querySelector('#focus-timer .glass-card').classList.remove('timer-pulse');
    
    if (currentMode === 'focus') {
        completedSessions++;
        document.getElementById('session-count').innerText = `Completed Sessions: ${completedSessions}`;
        alert("Session Completed! Take a break.");
    } else {
        alert("Break over! Ready to focus?");
    }
    resetTimer();
}

function resetTimer() {
    setTimerMode(currentMode);
}

   </script>
</body>
</html>